# Blynk IoT Extension for MicroBlock ESP32

A comprehensive Blynk IoT extension for MicroBlock specifically optimized for ESP32 with automatic WiFi management and memory optimization. Compatible with MicroPython v1.6+ and Blynk library v1.3.2.

## ðŸš€ ESP32 Optimized Features

### Core Blynk Functions
- **Blynk Init** - Initialize connection with auto-WiFi for ESP32
- **Blynk Run** - Process Blynk messages with ESP32 memory management  
- **Virtual Write** - Send data to virtual pins
- **Virtual Sync** - Request current value from virtual pin
- **Connection Status** - Check if connected to Blynk cloud

### ESP32 WiFi Management
- **WiFi Connect** - Easy WiFi connection with credentials
- **WiFi Info** - Get WiFi status, IP address, and RSSI
- **Auto-Reconnect** - Automatic WiFi reconnection on disconnect
- **Connection Monitor** - Real-time WiFi status monitoring

### ESP32 Performance  
- **Memory Info** - Monitor ESP32 RAM usage
- **Memory Cleanup** - Automatic garbage collection
- **Batch Sending** - Optimized data transmission
- **Low Memory Alerts** - Automatic memory management

### Event Handlers
- **Virtual Pin Read** - Handle requests when app reads virtual pin
- **Virtual Pin Write** - Handle data when app writes to virtual pin  
- **Connect Event** - Execute code when connected to Blynk
- **Disconnect Event** - Execute code when disconnected from Blynk

### Notifications & Communication
- **Notify** - Send push notifications to mobile app
- **Email** - Send emails through Blynk
- **Log Event** - Log events to Blynk console

### Advanced Features (v1.3.2+)
- **Template ID** - Set Blynk Template ID for IoT projects
- **Device Name** - Configure device name (defaults to "ESP32 Device")
- **Firmware Version** - Set firmware version information
- **Update Property** - Enhanced widget property updates
- **Batch Send** - Send multiple values efficiently for ESP32
- **Set Property** - Configure widget properties (color, label, etc.)

## ðŸ“± Quick Start for ESP32

### 1. MicroBlock Setup
```python
# This code is automatically generated by MicroBlock blocks:

import blynklib_mp as blynklib

# Initialize Blynk with ESP32 auto-WiFi
blynk = blynklib.Blynk(
    "YourAuthTokenHere",
    server="blynk.cloud", 
    port=80,
    wifi_ssid="YourWiFiName",      # Auto-connect to this WiFi
    wifi_pass="YourWiFiPassword", 
    auto_wifi=True,                # Enable auto WiFi management
    device_name="ESP32 Device",
    firmware_version="2.0.0"
)

# Main loop
while True:
    blynk.run()  # Handles WiFi + Blynk automatically
    time.sleep(0.1)
```

### 2. WiFi Connection (ESP32)
```python
# Manual WiFi connection
wifi_connected = blynk.wifi_connect("YourWiFi", "YourPassword")
if wifi_connected:
    print("WiFi connected successfully!")

# Check WiFi status
wifi_status = blynk.wifi_info()
print("WiFi IP:", wifi_status.get('config'))
print("WiFi RSSI:", wifi_status.get('rssi'))
```

### 3. Memory Management (ESP32)
```python
# Check ESP32 memory
memory_status = blynk.memory_info()
print("Free memory:", memory_status['free'], "bytes")

# Force memory cleanup if needed
if memory_status['free'] < 10000:  # Less than 10KB
    blynk.cleanup_memory()
```

### 4. Efficient Data Sending
```python
# Send multiple sensor values efficiently
blynk.batch_send_start()
blynk.virtual_write(1, temperature)
blynk.virtual_write(2, humidity)  
blynk.virtual_write(3, pressure)
blynk.batch_send_end()  # Sends all data in one packet
```

### 5. Event Handlers
```python
@blynk.handle_event("read V1")
def read_sensor(pin):
    # Send sensor data when app requests
    sensor_value = 25.5  # Replace with actual sensor reading
    blynk.virtual_write(pin, sensor_value)

@blynk.handle_event("write V2") 
def control_device(pin, values):
    # Control ESP32 GPIO from app
    state = int(values[0])
    # Use with machine.Pin for actual GPIO control
    print("Device control:", state)
```

## ðŸ”§ ESP32 Hardware Support

### Pin Control Integration
```python
# Example GPIO control (requires machine module)
from machine import Pin, PWM

# LED control
led = Pin(2, Pin.OUT)  # ESP32 built-in LED

@blynk.handle_event("write V2")
def led_control(pin, values):
    led.value(int(values[0]))  # Control LED from app

# PWM control  
pwm_pin = PWM(Pin(4))
pwm_pin.freq(1000)

@blynk.handle_event("write V3")
def pwm_control(pin, values):
    duty = int(values[0]) * 10  # Scale 0-100 to 0-1023
    pwm_pin.duty(duty)
```

### Sensor Reading
```python
# ADC sensor reading
from machine import ADC

adc = ADC(Pin(36))
adc.atten(ADC.ATTN_11DB)

@blynk.handle_event("read V4")
def read_analog(pin):
    reading = adc.read()
    voltage = reading * 3.3 / 4095
    blynk.virtual_write(pin, voltage)
```

## ðŸŽ›ï¸ ESP32 Performance Tips

### Memory Optimization
- ESP32 has limited RAM (~320KB), use memory efficiently
- Call `blynk.cleanup_memory()` periodically
- Monitor memory with `blynk.memory_info()`
- Use batch sending for multiple values

### WiFi Stability
- Set `auto_wifi=True` for automatic reconnection
- Check WiFi status with `blynk.wifi_info()`
- Use shorter heartbeat intervals for better connection monitoring
- Handle WiFi disconnections gracefully

### Real-time Performance
- Call `blynk.run()` every 100ms or less
- Avoid blocking operations in event handlers
- Use hardware timers for time-critical tasks
- Optimize sensor reading frequency

## ðŸ“‹ Supported Platforms

- **ESP32** - âœ… Full support with WiFi auto-management
- **ESP32-S2** - âœ… Full support
- **ESP32-C3** - âœ… Full support  
- **ESP32-S3** - âœ… Full support
- **ESP8266** - âœ… Compatible (limited memory)
- **Raspberry Pi Pico W** - âš ï¸ Basic support
- **Other MicroPython boards** - âš ï¸ Limited support

## ðŸ“¦ Installation for MicroBlock

1. Download this extension folder
2. Copy `blynk-ext` to your MicroBlock extensions directory
3. Restart MicroBlock
4. Find "Blynk IoT" blocks in the Communication category
5. Use the ESP32-optimized blocks for your projects

## ðŸ”— Blynk App Setup

1. Download Blynk IoT app:
   - [iOS App Store](https://apps.apple.com/app/blynk-iot/id1559317868)
   - [Google Play Store](https://play.google.com/store/apps/details?id=cloud.blynk)

2. Create a new template or device
3. Add widgets and configure virtual pins
4. Copy your Auth Token from device info
5. Use the Auth Token in your MicroBlock project

## ðŸŽ¯ ESP32 Example Projects

### IoT Weather Station
- Temperature, humidity, pressure sensors
- Real-time data display on Blynk app
- Historical data logging
- Alert notifications

### Smart Home Controller  
- LED strip control with color picker
- Relay control for appliances
- Motion sensor monitoring
- Door/window status tracking

### Industrial Monitor
- Motor control and monitoring
- Temperature/vibration sensors
- Production counters
- Alarm systems

## ðŸ” Troubleshooting ESP32

### WiFi Issues
```python
# Check WiFi connection
wifi_info = blynk.wifi_info()
if not wifi_info['connected']:
    print("WiFi not connected!")
    # Try manual reconnection
    blynk.wifi_connect("SSID", "PASSWORD")
```

### Memory Issues  
```python
# Monitor memory usage
memory = blynk.memory_info()
print(f"Free: {memory['free']}B, Used: {memory['allocated']}B")

# Clean up if low memory
if memory['free'] < 15000:
    blynk.cleanup_memory()
```

### Connection Problems
- Verify Auth Token from Blynk app
- Check WiFi credentials
- Ensure internet connection is stable
- Try different Blynk servers if needed

## ðŸ“š Version History

- **v2.0.0-ESP32** - ESP32 optimized version
  - Auto WiFi management for ESP32
  - Memory optimization and monitoring
  - Enhanced performance for ESP32 hardware
  - Batch sending optimization
  - Real-time WiFi status monitoring
  - ESP32-specific error handling

- **v2.0.0** - Updated for Blynk library v1.3.2
  - Template ID and Device Name support
  - Enhanced property management
  - Batch sending capabilities  
  - Improved MicroPython v1.6+ compatibility
  - Better error handling and connection stability

## ðŸ“„ License

MIT License

## ðŸŽ–ï¸ Credits

- Based on [Blynk library](https://github.com/blynkkk/blynk-library)
- MicroPython adaptation by [Volodymyr Shymanskyy](https://github.com/vshymanskyy)
- ESP32 optimization for MicroBlock by Cap_Apiluk

## ðŸ”— Links

- [Blynk Documentation](https://docs.blynk.io/)
- [Blynk Community](https://community.blynk.cc/)
- [MicroBlock](https://microblock.cc/)
- [MicroPython ESP32](https://docs.micropython.org/en/latest/esp32/)
- [ESP32 Technical Reference](https://www.espressif.com/sites/default/files/documentation/esp32_technical_reference_manual_en.pdf)